<!DOCTYPE html>
<html lang="en">
<style>
    .select {
        padding: 15px 10px;
    }
    .select input[type=radio]{
        display: none;
    }
    .select input[type=radio]+label{
        display: inline-block;
        cursor: pointer;
        height: 24px;
        width: 90px;
        border: 1px solid #333;
        line-height: 24px;
        text-align: center;
        font-weight:bold;
        font-size:13px;
    }
    .select input[type=radio]+label{
        background-color: #fff;
        color: #333;
    }
    .select input[type=radio]:checked+label{
        background-color: #333;
        color: #fff;
    }
</style>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>게시물 수정</title>
</head>
<body>
<!-- checked="checked" -->
<div class="select">
    <input type="radio" id="korea" name="race" onclick="showDiv(this);" ><label for="korea">Korea</label>
    <input type="radio" id="world" name="race"  onclick="showDiv(this);"><label for="world">World</label>
</div>
<form th:action= "@{/post/{postId}/edit(postId=${prePost.id})}" method="post">

<div id = "koreaBox" class="box" style="display: none">
    <table>
        <tr>
            <th>모집상태</th>
            <td><input type="text" name="status" placeholder="모집상태를 골라주세요." list = "status" th:value = "${prePost.status}" >
                <datalist id = "postStatus">
                    <option value="모집중"></option>
                    <option value="모집완료"></option>
                </datalist>
            </td>
        </tr>
        <tr>
            <th>제목</th>
            <td><input type="text" name="title" placeholder="title" th:value = "${prePost.title}" /></td>
        </tr>
        <tr>
            <th>모집기간</th>
            <td><input type="text" name="untilRecruit" placeholder="untilRecruit" th:value = "${prePost.untilRecruit}"/></td>
        </tr>
        <tr>
            <th>버킷 시작일</th>
            <td><input type="text" name="eventStart" placeholder="date-start" th:value = "${prePost.eventStart}"/></td>
        </tr>
        <tr>
            <th>버킷 종료일</th>
            <td><input type="text" name="eventEnd" placeholder="date-finish" th:value = "${prePost.eventEnd}"/></td>
        </tr>
        <tr>
            <th>비용</th>
            <td><input type="text" name="cost" placeholder="3000000" th:value = "${prePost.cost}"/></td>
        </tr>
        <tr>
            <th>모집인원</th>
            <td><input type="text" name="entrantNum" placeholder="member" th:value = "${prePost.entrantNum}"/></td>
        </tr>
        <tr>
            <th>카테고리</th>
            <td><input type="text" name="category" placeholder="category" th:value = "${prePost.category}"/></td>

        </tr>
        <tr>
            <th>주소</th>
            <td><input type="text" id="address_kakao" name="location" readonly th:value = "${prePost.location}"/></td>
        </tr>
        <tr>
            <th>내용</th>
            <td><input type="text" name="content" placeholder="content" th:value = "${prePost.content}"/></td>
        </tr>
    </table>
</div>
    <input type="submit" value="제출"/>
</form>

<div name = "form" id = "worldBox" class="box" style="display: none">
    <table>
        <tr>
            <th>모집상태</th>
            <td><input type="text" name="status" placeholder="모집상태를 골라주세요." list = "status" >
                <datalist id = "status">
                    <option value="모집중"></option>
                    <option value="모집완료"></option>
                </datalist>
            </td>
        </tr>
        <tr>
            <th>제목</th>
            <td><input type="text" id="title" name="post" placeholder="title" /></td>
        </tr>
        <tr>
            <th>모집기간</th>
            <td><input type="text" id="untilRecruit" name="post" placeholder="untilRecruit"/></td>
        </tr>
        <tr>
            <th>버킷 시작일</th>
            <td><input type="text" name="post" placeholder="date-start" /></td>
        </tr>
        <tr>
            <th>버킷 종료일</th>
            <td><input type="text" name="post" placeholder="date-finish" /></td>
        </tr>
        <tr>
            <th>비용</th>
            <td><input type="text" name="post" placeholder="3000000" /></td>
        </tr>
        <tr>
            <th>모집인원</th>
            <td><input type="text" id="member" name="post" placeholder="member" /></td>
        </tr>
        <tr>
            <th>카테고리</th>
            <td><input type="text" id="cartegory" name="post" placeholder="category"/></td>
        </tr>
        <tr>
            <th>영문 주소</th>
            <td><input type="text" id="address" name="post" placeholder="5 Avenue Anatole France, 75007 Paris, France"/></td>
        </tr>
        <tr>
            <th>내용</th>
            <td><input type="text" name="post" placeholder="content" /></td>
        </tr>
    </table>
</div>
<input type="submit" id="submit" value="입력" >
</body>
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>

<!-- 주소 검색 api 사용-->
<script>
    window.onload = function(){
        document.getElementById("address_kakao").addEventListener("click", function(){ //주소입력칸을 클릭하면
            //카카오 지도 발생
            new daum.Postcode({
                oncomplete: function(data) { //선택시 입력값 세팅
                    document.getElementById("address_kakao").value = data.address; // 주소 넣기
                    document.querySelector("input[name=post]").focus(); //상세입력 포커싱
                }
            }).open();
        });
    }


    <!-- 라디오 버튼 클릭시 동작 -->
    function showDiv(element){
        var tag = document.getElementsByClassName("box");   // class 이름이 box인 값들을 가져옴

        for(var i =0; i<tag.length; i++){     // tag[0] = koreanBox, tag[1] = foreignerBox
            if(element.id+"Box"== tag[i].id)    // korean+"Box"가 tag[0]의 값과 같을때 해당 div 출력
                tag[i].style.display = "block";
            else                                // 다르다면 div 숨기기
                tag[i].style.display = "none";
        }
    }
</script>



<script type="text/javascript" src="http://code.jquery.com/jquery-3.5.1.min.js"></script>
<script th:inline="javascript">
    window.onload = function(){
        document.getElementById("address_kakao").addEventListener("click", function(){ //주소입력칸을 클릭하면
            //카카오 지도 발생
            new daum.Postcode({
                oncomplete: function(data) { //선택시 입력값 세팅
                    document.getElementById("address_kakao").value = data.address; // 주소 넣기
                    document.querySelector("input[name=post]").focus(); //상세입력 포커싱
                }
            }).open();
        });
    }


    <!-- 라디오 버튼 클릭시 동작 -->
    function showDiv(element){
        var tag = document.getElementsByClassName("box");   // class 이름이 box인 값들을 가져옴

        for(var i =0; i<tag.length; i++){     // tag[0] = koreanBox, tag[1] = foreignerBox
            if(element.id+"Box"== tag[i].id)    // korean+"Box"가 tag[0]의 값과 같을때 해당 div 출력
                tag[i].style.display = "block";
            else                                // 다르다면 div 숨기기
                tag[i].style.display = "none";
        }
    }

    $(document).ready(function(){
        $("#submit").click(function() {

            // 게시물 배열 선언
            let arr = [];
            const postId = [[${prePost.id}]];

            $('input[name="post"]').each(function(index,item){ // 모든 값 배열에 저장
                arr.push($(item).val());
            });


            var finddata = $("#address_kakao").val();   // 국내 주소 값 저장

            if(finddata.length <1){     // 만약 국내 주소 값의 크기가 1보다 작을때, 즉 국내에서 데이터를 작성한 것이 아닐때
                alert("world data")
                var WorldData = {       // 해외 데이터
                    "title" : arr[9],       // 제목
                    "untilRecruit" : arr[10],    // 모집종료 날짜
                    "eventStart" : arr[11],       // 시작일
                    "eventEnd" : arr[12],          // 종료일
                    "cost" : arr[13],              // 비용
                    "entrantNum" : arr[14],         // 모집인원
                    "category" : arr[15],       // 카테고리
                    "location" : arr[16],        // 장소
                    "content" : arr[17]         // 내용
                }

                //ajax 호출
                $.ajax({
                    type        :   "post",
                    url         :   `/post/${postId}/edit`,
                    headers : {
                        "Content-Type" : "application/json"
                    },
                    dataType    :   "text",
                    // contentType :   "application/json",
                    data        :   JSON.stringify(WorldData),
                    async : false,
                    success     :   function(data){
                        console.log(data);
                        let url = '/map?postId=${data}';
                        window.location.replace(url);
                    }
                });
            }

            else{           // 국내에서 작성했을때
                alert("korea data")
                var KoreaData = {         // 한국 데이터
                    "title" : arr[0],       // 제목
                    "untilRecruit" : arr[1],    // 모집종료 날짜
                    "eventStart" : arr[2],       // 시작일
                    "eventEnd" : arr[3],          // 종료일
                    "cost" : arr[4],              // 비용
                    "entrantNum" : arr[5],         // 모집인원
                    "category" : arr[6],       // 카테고리
                    "location" : arr[7],        // 장소
                    "content" : arr[8]         // 내용
                }

                //ajax 호출
                $.ajax({
                    type        :   "post",
                    url         :   `/post/${postId}/edit`,
                    headers : {
                        "Content-Type" : "application/json",
                    },
                    dataType    :   "text",
                    // contentType :   "application/json",
                    data        :   JSON.stringify(KoreaData),
                    async : false,
                    success     :   function(data){      // server에서 결과값 받아옴
                        let url = "/post/"+data;
                        window.location.replace(url);     // ajax에서 redirect 진행
                    }
                });
            }
        })
    });
</script>
</html>